import type { Metadata } from 'next'

export const metadata: Metadata = {
  title: 'Zpƒõtn√° Vazba - SubtitleBot',
  description: 'Sd√≠lejte svou zpƒõtnou vazbu a pomozte n√°m vylep≈°it SubtitleBot. Anonymn√≠ a rychl√Ω formul√°≈ô pro n√°vrhy, hl√°≈°en√≠ chyb a po≈æadavky na funkce.',
  robots: {
    index: true,
    follow: true,
  },
}

'use client'

import { useState, useEffect } from 'react'
import { analytics } from '@/lib/analytics'
import { Button } from '@/components/ui/button'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Textarea } from '@/components/ui/textarea'
import { MessageSquare, Send, Loader2, CheckCircle, ArrowLeft } from 'lucide-react'
import Link from 'next/link'
import { toast } from 'sonner'

export default function CzechFeedbackPage() {
  const [feedback, setFeedback] = useState('')
  const [isSubmitting, setIsSubmitting] = useState(false)
  const [isSubmitted, setIsSubmitted] = useState(false)
  const [honeypot, setHoneypot] = useState('')
  const [startTime] = useState(Date.now())

  useEffect(() => {
    // Track feedback page visit
    analytics.feedbackPageVisited('cs')
  }, [])

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    
    // Anti-spam checks
    if (honeypot) {
      // Bot detected (filled honeypot field)
      return
    }
    
    if (Date.now() - startTime < 3000) {
      // Submitted too quickly (less than 3 seconds)
      toast.error('Pros√≠m, vƒõnujte chvilku naps√°n√≠ zpƒõtn√© vazby.')
      return
    }
    
    if (feedback.trim().length < 10) {
      toast.error('Pros√≠m, poskytnƒõte podrobnƒõj≈°√≠ zpƒõtnou vazbu (alespo≈à 10 znak≈Ø).')
      return
    }

    setIsSubmitting(true)

    try {
      const response = await fetch('/api/feedback', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          feedback: feedback.trim(),
          timestamp: new Date().toISOString(),
          userAgent: navigator.userAgent,
          url: window.location.href,
          locale: 'cs'
        }),
      })

      if (!response.ok) {
        throw new Error('Failed to send feedback')
      }

      setIsSubmitted(true)
      toast.success('Dƒõkujeme za va≈°i zpƒõtnou vazbu!')

      // Track successful feedback submission
      analytics.feedbackSubmitted('cs', feedback.length)

      setFeedback('')
    } catch (error) {
      console.error('Feedback error:', error)
      toast.error('Nepoda≈ôilo se odeslat zpƒõtnou vazbu. Zkuste to pros√≠m znovu.')
    } finally {
      setIsSubmitting(false)
    }
  }

  if (isSubmitted) {
    return (
      <div className="min-h-screen bg-background">
        <div className="container mx-auto px-4 py-12 max-w-2xl">
          <Button variant="ghost" asChild className="mb-4">
            <Link href="/cs" className="flex items-center gap-2">
              <ArrowLeft className="h-4 w-4" />
              Zpƒõt na Hlavn√≠ Str√°nku
            </Link>
          </Button>
          
          <Card>
            <CardContent className="pt-6">
              <div className="text-center space-y-4">
                <CheckCircle className="h-16 w-16 text-green-500 mx-auto" />
                <h2 className="text-2xl font-bold text-foreground">Dƒõkujeme!</h2>
                <p className="text-muted-foreground">
                  Va≈°e zpƒõtn√° vazba byla p≈ôijata. V√°≈æ√≠me si toho, ≈æe jste si na≈°li ƒças pomoci n√°m vylep≈°it SubtitleBot!
                </p>
                <Button asChild>
                  <Link href="/cs">Zpƒõt na Hlavn√≠ Str√°nku</Link>
                </Button>
              </div>
            </CardContent>
          </Card>
        </div>
      </div>
    )
  }

  return (
    <div className="min-h-screen bg-background">
      <div className="container mx-auto px-4 py-12 max-w-2xl">
        <Button variant="ghost" asChild className="mb-4">
          <Link href="/cs" className="flex items-center gap-2">
            <ArrowLeft className="h-4 w-4" />
            Zpƒõt na Hlavn√≠ Str√°nku
          </Link>
        </Button>

        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <MessageSquare className="h-6 w-6 text-primary" />
              Rychl√° Zpƒõtn√° Vazba
            </CardTitle>
            <CardDescription>
              Pomozte n√°m vylep≈°it SubtitleBot! Sd√≠lejte sv√© my≈°lenky, n√°vrhy nebo nahlaste probl√©my. 
              Va≈°e zpƒõtn√° vazba je anonymn√≠ a pom√°h√° n√°m udƒõlat aplikaci lep≈°√≠ pro v≈°echny.
            </CardDescription>
          </CardHeader>
          <CardContent>
            <form onSubmit={handleSubmit} className="space-y-6">
              {/* Honeypot field - hidden from users, visible to bots */}
              <input
                type="text"
                name="website"
                value={honeypot}
                onChange={(e) => setHoneypot(e.target.value)}
                style={{ display: 'none' }}
                tabIndex={-1}
                autoComplete="off"
              />

              <div className="space-y-2">
                <label htmlFor="feedback" className="text-sm font-medium">
                  Va≈°e Zpƒõtn√° Vazba
                </label>
                <Textarea
                  id="feedback"
                  placeholder="Co byste chtƒõli vidƒõt vylep≈°en√©? Nƒõjak√© chyby nebo probl√©my? Nov√© funkce, kter√© byste milovali? R√°di usly≈°√≠me v√°≈° n√°zor!"
                  value={feedback}
                  onChange={(e) => setFeedback(e.target.value)}
                  disabled={isSubmitting}
                  rows={6}
                  className="resize-none"
                />
                <p className="text-xs text-muted-foreground">
                  {feedback.length}/1000 znak≈Ø ‚Ä¢ Anonymn√≠ odesl√°n√≠
                </p>
              </div>

              <Button
                type="submit"
                className="w-full"
                disabled={isSubmitting || feedback.trim().length < 10}
              >
                {isSubmitting ? (
                  <>
                    <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                    Odes√≠l√°n√≠ Zpƒõtn√© Vazby...
                  </>
                ) : (
                  <>
                    <Send className="h-4 w-4 mr-2" />
                    Odeslat Anonymn√≠ Zpƒõtnou Vazbu
                  </>
                )}
              </Button>
            </form>

            <div className="mt-6 p-4 bg-muted/50 rounded-lg">
              <h4 className="text-sm font-medium mb-2">üí° Jak√° zpƒõtn√° vazba n√°m nejv√≠ce pom√°h√°:</h4>
              <ul className="text-xs text-muted-foreground space-y-1">
                <li>‚Ä¢ Chyby nebo probl√©my, se kter√Ωmi jste se setkali</li>
                <li>‚Ä¢ Funkce, kter√© by v√°m usnadnily pr√°ci</li>
                <li>‚Ä¢ Jazyky nebo form√°ty, kter√© byste chtƒõli vidƒõt podporovan√©</li>
                <li>‚Ä¢ Probl√©my s v√Ωkonem nebo pomal√© p≈ôeklady</li>
                <li>‚Ä¢ Vylep≈°en√≠ UI/UX, kter√° by v√°m pomohla</li>
              </ul>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  )
}
